<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="icon" href="aswicon.png" type="image/png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ASW SMP | Server Info</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="layout">
    <!-- Main Title -->
    <div class="card main">
      <h1 class="gradient-title">MC.PLAYASW.COM</h1>
    </div>

    <!-- Server Status -->
    <div class="sidebar server-status">
      <h2>Server Status</h2>
      <div class="status-container">
        <p id="status" class="status loading">
          <span class="dot"></span>
          <span class="label">Checking status</span>
        </p>
        <button id="refresh-btn">Refresh</button>
      </div>
    </div>


    <!-- Player List -->
    <div class="sidebar player-list">
      <h2 id="player-header">Online players: 0/0</h2>
      <ul id="player-list">
        <li id="no-players">Loading...</li>
      </ul>
    </div>
  </div>

  <script>
    const serverIP = "mc.playasw.com";

    const statusEl = document.getElementById("status");
    const labelEl = statusEl.querySelector(".label");
    const playerHeaderEl = document.getElementById("player-header");
    const playersListEl = document.getElementById("player-list");

    function setStatus(state, text) {
      statusEl.className = `status ${state}`;
      labelEl.textContent = text;
    }
    async function fetchServerStatus() {
      setStatus("loading", "Checking status...");

      const startTime = Date.now(); // track when fetch starts

      try {
        const res = await fetch(`https://api.mcsrvstat.us/2/${serverIP}`);
        const data = await res.json();

        // Ensure minimum 1 second
        const elapsed = Date.now() - startTime;
        if (elapsed < 1000) {
          await new Promise(resolve => setTimeout(resolve, 1000 - elapsed));
        }

        // Clear previous player list
        playersListEl.innerHTML = "";

        if (data && data.online) {
          setStatus("online", "No issues");
          playerHeaderEl.textContent = `Online players: ${data.players.online} / ${data.players.max}`;

          if (data.players && Array.isArray(data.players.list) && data.players.list.length) {
            data.players.list.forEach(name => {
              const li = document.createElement('li');
              li.textContent = name;
              playersListEl.appendChild(li);
            });
          } else if (data.players && data.players.online > 0) {
            playersListEl.innerHTML = "<li>Players online (names not available)</li>";
          } else {
            playersListEl.innerHTML = "<li>No players online</li>";
          }
        } else {
          setStatus("offline", "Server offline");
          playerHeaderEl.textContent = `Online players: 0 / 0`;
          playersListEl.innerHTML = "<li>Server offline</li>";
        }
      } catch (err) {
        // Ensure minimum 1 second even on error
        const elapsed = Date.now() - startTime;
        if (elapsed < 1000) await new Promise(resolve => setTimeout(resolve, 1000 - elapsed));

        setStatus("error", "Status unavailable");
        playerHeaderEl.textContent = `Online players: 0 / 0`;
        playersListEl.innerHTML = "<li>Error loading players</li>";
        console.error(err);
      }
    }


    const refreshBtn = document.getElementById("refresh-btn");

    refreshBtn.addEventListener("click", () => {
      fetchServerStatus(); // Immediately fetch status
      startCooldown(30);  // Start 30s cooldown
    });

    function startCooldown(seconds) {
      let remaining = seconds;
      refreshBtn.disabled = true;
      refreshBtn.textContent = `Refresh (${remaining})`;

      const interval = setInterval(() => {
        remaining--;
        if (remaining > 0) {
          refreshBtn.textContent = `Refresh (${remaining})`;
        } else {
          clearInterval(interval);
          refreshBtn.disabled = false;
          refreshBtn.textContent = "Refresh";
        }
      }, 1000);
    }


    fetchServerStatus();
  </script>
</body>

</html>